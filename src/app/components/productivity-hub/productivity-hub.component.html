<section id="about" class="about" [ngClass]="{'section-show': isSectionActive}">

	<div class="about-me container c_custom ">

		<div class="section-title">
			<h2>productivity</h2>


			<!-- <p>Pomodoro Time</p> -->
		</div>

		<div class="row d-flex justify-content-center ">
			<div class=" col-sm-10 col-md-5 col-lg-4 col-12">
				<div #colRef>
					<div *ngIf="pomodoro" class="pomodoro-background">
						<div class="pomodoro-face-outline">
							<div class="pomodoro-face-outline-point point-12"></div>
							<div class="pomodoro-face-outline-point point-1"></div>
							<div class="pomodoro-face-outline-point point-2"></div>
							<div class="pomodoro-face-outline-point point-3"></div>
							<div class="pomodoro-face-outline-point point-4"></div>
							<div class="pomodoro-face-outline-point point-5"></div>
							<div class="pomodoro-face-outline-point point-6"></div>
							<div class="pomodoro-face-outline-point point-7"></div>
							<div class="pomodoro-face-outline-point point-8"></div>
							<div class="pomodoro-face-outline-point point-9"></div>
							<div class="pomodoro-face-outline-point point-10"></div>
							<div class="pomodoro-face-outline-point point-11"></div>
						</div>

						<div class="pomodoro-face-centre">
							<div class="pomodoro-face-centre-inner"></div>
						</div>

						<div class="pomodoro-face-hands">
							<div class="pomodoro-face-hand hour" #hourHand></div>
							<div class="pomodoro-face-hand minute" #minuteHand></div>
							<div class="pomodoro-face-hand second" #secondHand></div>
						</div>
					</div>
				</div>

				<!-- {{clock | json}} -->
				<div class="square" style="position: relative;"
					[ngClass]="{'rest': clock.pomodoroState === 'shortBreak', 'longRest': clock.pomodoroState === 'longBreak','work': clock.pomodoroState === 'work' && clock.timerStarted}">

					<div class="justify-content-center d-flex">
						<button (click)="changePomodoroState('work')" class="btn botonMenu me-1"
							[ngClass]="{'active': clock.pomodoroState === 'work'}"> Work Time</button>
						<button (click)="changePomodoroState('shortBreak')" class="btn botonMenu me-1"
							[ngClass]="{'active': clock.pomodoroState === 'shortBreak'}"> Short Break</button>
						<button (click)="changePomodoroState('longBreak')" class="btn botonMenu"
							[ngClass]="{'active': clock.pomodoroState === 'longBreak'}"> Long Break</button>
					</div>
					<p class="countdown">{{getTimeLeft()*1000 | date:'mm:ss'}}</p>
					<div style="position: relative">
						<p *ngIf="clock.timerStarted" class="end-time">{{clock.startTime | date:"shortTime"}} <i
								class="ri-arrow-right-line"></i> {{clock.endTime | date:"shortTime" }}</p>
					</div>

					<div class="container" style="height: 30px">
						<div class="d-flex justify-content-center align-items-center">
							<!-- <div *ngFor="let tomato of [].constructor(pomodoroCounter); let i = index" >
							<img src="/assets/productivity/tomato.png" class="pomodoroComplete" width="50" height="50">
						  </div> -->
							<div *ngFor="let tomato of [].constructor(clock.pomodoroQuarterCounter); let i = index">
								<img src="/assets/productivity/tomato.png" class="pomodoroQuarter" width="30"
									height="30">
							</div>
							<div *ngIf="clock.timerStarted">
								<img src="/assets/productivity/tomato.png" class="pomodoroCurrent" width="30"
									height="30">
							</div>

						</div>
					</div>


					<div class="d-flex justify-content-between align-items-center ">
						<!-- Contenedor para el botón Back -->

						<div class="flex-grow-1 d-flex justify-content-end  " style="width: 100px">
							<button *ngIf="clock.undoStartTime>0" class="butoPlay" (click)="undoPomodoro()"
								style="display: flex; align-items: center;">
								<i class="ri-arrow-go-back-fill icono-petit"></i>
							</button>

						</div>

						<!-- Botones Play y Pause, uno visible a la vez, siempre centrados -->
						<div class="mx-auto">
							<button *ngIf="!clock.timerStarted && !clock.isPaused" class="butoPlay "
								(click)="startTimer()" style="display: flex; align-items: center;">
								<i class="ri-play-circle-fill icono-gran"></i> Start Timer
							</button>
							<button *ngIf="!clock.timerStarted && clock.isPaused" class="butoPlay "
								(click)="startTimer()" style="display: flex; align-items: center;">
								<i class="ri-play-circle-fill icono-gran"></i>
							</button>
							<button *ngIf="clock.timerStarted" class="butoPlay " (click)="pauseTimer()"
								style="display: flex; align-items: center;">
								<i class="ri-pause-circle-fill icono-gran"></i>
							</button>
						</div>

						<!-- Contenedor para el botón Skip -->
						<div class="flex-grow-1 d-flex justify-content-start" style="width: 100px">
							<button *ngIf="clock.timerStarted" class="butoPlay " (click)="nextPomodoroState()"
								style="display: flex; align-items: center;">
								<i class="ri-skip-right-fill icono-mitja"></i>
							</button>
						</div>
					</div>

					<div class="container buttonPanel">
						<!-- Barra de progreso con tiempo de inicio y fin -->
						<div class="row align-items-center ">
							<div class="col-auto ">
								<span>{{clock.elapsedTime*1000 | date:'mm:ss'}}</span>
							</div>
							<div class="col ">
								<div class="progress play">
									<div class="progress-bar bg-white play" role="progressbar"
										[style]="'width:'+getPercentage()+'%'" aria-valuenow="50" aria-valuemin="0"
										aria-valuemax="100"></div>
								</div>
							</div>
							<div class="col-auto ">
								<span>{{getPercentage()}}%</span>
							</div>
						</div>
					</div>

				</div>
			</div>

			<div class="col-12 col-md-7 col-lg-8">
				<div class="d-flex justify-content-between align-items-center">
					<div class="d-flex justify-content-between align-items-center">
						<div #newTaskButton >
							<button class="butoPlay" (click)="newTask()"><i class="ri-add-circle-line icono-mitja"></i></button>
						</div>
						<div style="position: relative;" class="ms-2 searchDiv d-flex justify-content-between align-items-center">
							<input (ngModelChange)="filterSearch($event)" class="searchInput flex-grow-1" id="searchInput" type="text" [(ngModel)]="searchInput">
							<span *ngIf="searchInput.length===0" class="animate__animated animate__fadeIn searchIcon ms-1" style="position: absolute;"><i class="ri-search-line"></i></span>
							<span (click)="clearSarch()" *ngIf="searchInput.length>0" class="animate__animated animate__fadeIn closeIcon" ><i class="ri-close-line"></i></span>

						</div>
						<div  (click)="loadUnfilteredTasksByLabel()" *ngIf="filteredLabel>=0" class="outline-label2 ms-2 " style="--color-base: var(--{{getLabelInfo(filteredLabel).color}}-color)">
								<i *ngIf="getLabelInfo(filteredLabel).icon" class="{{getLabelInfo(filteredLabel).icon}} me-1"></i>{{ getLabelInfo(filteredLabel).name  }} <i class="ri-close-large-line"></i>
						</div>
					</div>

		
					<div *ngIf="!this.taskService.taskLoaded" class=" text-center d-flex align-items-center mb-2">
						<div  class="ms-2 animate__animated animate__fadeIn">Loading tasks... </div>
						<div  class="ms-2 animate__animated animate__zoomIn">
							<div class="spinner-border" role="status">
							</div>
						</div>
					  </div>
				</div>
			
				<div *ngIf="tasks.length>0" class="animate__animated animate__fadeIn task-list">
				
					<div (click)="activeTask(i)" *ngFor="let task of tasks; let i = index"
						class="animate__animated animate__fadeIn card text-white task-card mb-1" [ngClass]="{'active': i===clock.actualTask}">
						<div class="card-body d-flex justify-content-between align-items-start p-2">
							
							<div class="card-title me-0 mb-0">
								<div class="  d-flex align-items-center">

								<div  (click)="loadFilteredTasksByLabel(task.label)" *ngIf="getLabelInfo(task.label)" class="outline-label me-2 " style="--color-base: var(--{{getLabelInfo(task.label).color}}-color)">
									<i *ngIf="getLabelInfo(task.label).icon" class="{{getLabelInfo(task.label).icon}} me-1"></i>{{ getLabelInfo(task.label).name  }} 
								</div>
								
								 {{task.name | truncate:50}}
								</div>
								<div class="small-detail">{{task.detail | truncate:70 }}</div>
								
								<div *ngIf="tasks[i].estimatedTime>0" class="small-detail"> <i
										class="ri-timer-line"></i> {{task.elapsedTime*1000 | customTimeFormat}} of
									{{task.estimatedTime | customTimeFormat }} - {{ taskTimePercentage(i) |
									number:'1.0-1' }}%</div>


								<div *ngIf="tasks[i].estimatedTime<1 &&tasks[i].elapsedTime >0" class="small-detail"> <i
										class="ri-timer-line"></i> {{task.elapsedTime*1000 | customTimeFormat}}
								</div>
							</div>

							<div class="d-flex">
								<button #editTaskButton (click)="editTask(i)" class="butoPlay"><i
										class="ri-edit-2-fill "></i></button>
							</div>
						</div>
						<!-- Barra de progreso al pie de cada tarjeta -->
						<div *ngIf="tasks[i].estimatedTime>0 " class="progress task">
							<div class="progress-bar bg-danger" role="progressbar task"
								style="width: {{taskTimePercentage(i)}}%"></div>
							<div class="progress-bar bg-grey" role="progressbar task"
								style="width: {{taskTimePercentage(i) -50}}%"></div>

						</div>
					</div>
				</div>

				<!-- <pre>{{tasks | json}}</pre> -->




			</div>
		</div>
	</div>
</section>
<app-task-modal (refreshTasks)="refreshTasks()"></app-task-modal>